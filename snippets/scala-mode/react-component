# -*- mode: snippet -*-
# name: react-component
# key: react-component
# --
package schaake.flex.client.$1

import japgolly.scalajs.react._
import japgolly.scalajs.react.vdom.html_<^._
import schaake.flex.client.dsl._

object `(file-name-nondirectory (file-name-sans-extension (buffer-file-name)))` {
  object Style extends FlexBaseStyle {
    import dsl._

    val main = style(padding(1.em))
  }

  final case class Props(${2:ctx: Context})
  sealed trait State
  object Loading extends State
  final case class Loaded($3) extends State

  class Backend($: BackendScope[Props, State]) {
    def onPropsChange(prev: Option[Props], next: Props) = Callback.empty
    val init = $.props >>= (p => onPropsChange(None, p))
    val deinit = Callback.empty
    
    def render(p: Props, s: State) = s match {
      case Loading => <.div(icons.loadingSmall, " Loading...")
      case l: Loaded => <.div(p.toString, s.toString)
    }
  }

  private val component = ScalaComponent.builder[Props]("`(file-name-nondirectory (file-name-sans-extension (buffer-file-name)))`")
    .initialState(Loading.asInstanceOf[State])
    .renderBackend[Backend]
    .componentDidMount(_.backend.init)
    .componentWillUnmount(_.backend.deinit)
    .componentWillReceiveProps(i => i.backend.onPropsChange(Some(i.currentProps), i.nextProps))
    .build

  def apply($2) = component(Props(${4:$2}))
}